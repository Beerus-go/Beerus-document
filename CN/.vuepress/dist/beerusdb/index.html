<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Beerus-DB | Beerus</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="用Go语言开发的Web解决方案">
    
    <link rel="preload" href="/cn/assets/css/0.styles.e8732725.css" as="style"><link rel="preload" href="/cn/assets/js/app.ba28a3bd.js" as="script"><link rel="preload" href="/cn/assets/js/2.67bc9379.js" as="script"><link rel="preload" href="/cn/assets/js/10.c49379fe.js" as="script"><link rel="prefetch" href="/cn/assets/js/11.666888d3.js"><link rel="prefetch" href="/cn/assets/js/3.b3f0d358.js"><link rel="prefetch" href="/cn/assets/js/4.96e9b071.js"><link rel="prefetch" href="/cn/assets/js/5.c776c5b5.js"><link rel="prefetch" href="/cn/assets/js/6.cee21277.js"><link rel="prefetch" href="/cn/assets/js/7.20bb3ad0.js"><link rel="prefetch" href="/cn/assets/js/8.a167c578.js"><link rel="prefetch" href="/cn/assets/js/9.085b4ccf.js">
    <link rel="stylesheet" href="/cn/assets/css/0.styles.e8732725.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cn/" class="home-link router-link-active"><!----> <span class="site-name">Beerus</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cn/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/yuyenews" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/yuyenews/Beerus/discussions" target="_blank" rel="noopener noreferrer" class="nav-link external">
  社区
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://t.me/beeruscc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Telegram
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/cn/sponsor/sponsor.html" class="nav-link">
  赞助
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cn/beerus/index.html" class="nav-link">
  Beerus
</a></li><li class="dropdown-item"><!----> <a href="/cn/beerusdb/index.html" class="nav-link">
  Beerus-db
</a></li></ul></div></div><div class="nav-item"><a href="https://www.bilibili.com/video/BV1cZ4y1X79f" target="_blank" rel="noopener noreferrer" class="nav-link external">
  视频演示
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://beeruscc.com/cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简体中文
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://beeruscc.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  English
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://magician-io.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cn/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/yuyenews" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/yuyenews/Beerus/discussions" target="_blank" rel="noopener noreferrer" class="nav-link external">
  社区
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://t.me/beeruscc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Telegram
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/cn/sponsor/sponsor.html" class="nav-link">
  赞助
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cn/beerus/index.html" class="nav-link">
  Beerus
</a></li><li class="dropdown-item"><!----> <a href="/cn/beerusdb/index.html" class="nav-link">
  Beerus-db
</a></li></ul></div></div><div class="nav-item"><a href="https://www.bilibili.com/video/BV1cZ4y1X79f" target="_blank" rel="noopener noreferrer" class="nav-link external">
  视频演示
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://beeruscc.com/cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简体中文
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://beeruscc.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  English
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://magician-io.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Beerus-DB</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cn/beerusdb/#初始化配置" class="sidebar-link">初始化配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cn/beerusdb/#安装依赖" class="sidebar-link">安装依赖</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#配置数据源" class="sidebar-link">配置数据源</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#配置多个数据源" class="sidebar-link">配置多个数据源</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#字段解释" class="sidebar-link">字段解释</a></li></ul></li><li><a href="/cn/beerusdb/#单表操作" class="sidebar-link">单表操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cn/beerusdb/#根据条件查询单表数据" class="sidebar-link">根据条件查询单表数据</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#根据条件修改单表数据" class="sidebar-link">根据条件修改单表数据</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#根据条件删除单表数据" class="sidebar-link">根据条件删除单表数据</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#插入一条数据" class="sidebar-link">插入一条数据</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#条件设定器说明" class="sidebar-link">条件设定器说明</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#实体映射说明" class="sidebar-link">实体映射说明</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#实体的使用" class="sidebar-link">实体的使用</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#查询结果转化成struct" class="sidebar-link">查询结果转化成struct</a></li></ul></li><li><a href="/cn/beerusdb/#自定义sql操作" class="sidebar-link">自定义sql操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cn/beerusdb/#根据数组参数查询" class="sidebar-link">根据数组参数查询</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#根据struct参数查询" class="sidebar-link">根据struct参数查询</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#根据数组参数做增删改" class="sidebar-link">根据数组参数做增删改</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#根据struct参数做增删改" class="sidebar-link">根据struct参数做增删改</a></li></ul></li><li><a href="/cn/beerusdb/#分页查询" class="sidebar-link">分页查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cn/beerusdb/#使用默认的countsql" class="sidebar-link">使用默认的countSql</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#使用自定义的countsql" class="sidebar-link">使用自定义的countSql</a></li></ul></li><li><a href="/cn/beerusdb/#事务管理" class="sidebar-link">事务管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cn/beerusdb/#开启事务" class="sidebar-link">开启事务</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#提交和回滚事务" class="sidebar-link">提交和回滚事务</a></li><li class="sidebar-sub-header"><a href="/cn/beerusdb/#连起来使用就是这样的" class="sidebar-link">连起来使用就是这样的</a></li></ul></li><li><a href="/cn/beerusdb/#web管理" class="sidebar-link">Web管理</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="beerus-db"><a href="#beerus-db" class="header-anchor">#</a> Beerus-DB</h1> <h2 id="初始化配置"><a href="#初始化配置" class="header-anchor">#</a> 初始化配置</h2> <h3 id="安装依赖"><a href="#安装依赖" class="header-anchor">#</a> 安装依赖</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>go get github.com/yuyenews/Beerus-DB@v1.1.1

go get github.com/go-sql-driver/mysql
</code></pre></div><h3 id="配置数据源"><a href="#配置数据源" class="header-anchor">#</a> 配置数据源</h3> <div class="language-go extra-class"><pre class="language-go"><code>dbPool <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>pool<span class="token punctuation">.</span>DbPool<span class="token punctuation">)</span>
dbPool<span class="token punctuation">.</span>InitialSize <span class="token operator">=</span> <span class="token number">1</span>
dbPool<span class="token punctuation">.</span>ExpandSize <span class="token operator">=</span> <span class="token number">1</span>
dbPool<span class="token punctuation">.</span>MaxOpen <span class="token operator">=</span> <span class="token number">1</span>
dbPool<span class="token punctuation">.</span>MinOpen <span class="token operator">=</span> <span class="token number">0</span>
dbPool<span class="token punctuation">.</span>TestConn <span class="token operator">=</span> <span class="token boolean">true</span>
dbPool<span class="token punctuation">.</span>Url <span class="token operator">=</span> <span class="token string">&quot;root:123456@(127.0.0.1:3306)/xt-manager&quot;</span>

db<span class="token punctuation">.</span><span class="token function">AddDataSource</span><span class="token punctuation">(</span><span class="token string">&quot;dbPoolTest&quot;</span><span class="token punctuation">,</span> dbPool<span class="token punctuation">)</span>
</code></pre></div><h3 id="配置多个数据源"><a href="#配置多个数据源" class="header-anchor">#</a> 配置多个数据源</h3> <p>只需要重复上面步骤即可</p> <div class="language-go extra-class"><pre class="language-go"><code>dbPool <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>pool<span class="token punctuation">.</span>DbPool<span class="token punctuation">)</span>
dbPool<span class="token punctuation">.</span>InitialSize <span class="token operator">=</span> <span class="token number">1</span>
dbPool<span class="token punctuation">.</span>ExpandSize <span class="token operator">=</span> <span class="token number">1</span>
dbPool<span class="token punctuation">.</span>MaxOpen <span class="token operator">=</span> <span class="token number">1</span>
dbPool<span class="token punctuation">.</span>MinOpen <span class="token operator">=</span> <span class="token number">0</span>
dbPool<span class="token punctuation">.</span>TestConn <span class="token operator">=</span> <span class="token boolean">true</span>
dbPool<span class="token punctuation">.</span>Url <span class="token operator">=</span> <span class="token string">&quot;root:123456@(127.0.0.1:3306)/test&quot;</span>

db<span class="token punctuation">.</span><span class="token function">AddDataSource</span><span class="token punctuation">(</span><span class="token string">&quot;dbPoolTest&quot;</span><span class="token punctuation">,</span> dbPool<span class="token punctuation">)</span>

dbPool2 <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>pool<span class="token punctuation">.</span>DbPool<span class="token punctuation">)</span>
dbPool2<span class="token punctuation">.</span>InitialSize <span class="token operator">=</span> <span class="token number">1</span>
dbPool2<span class="token punctuation">.</span>ExpandSize <span class="token operator">=</span> <span class="token number">1</span>
dbPool2<span class="token punctuation">.</span>MaxOpen <span class="token operator">=</span> <span class="token number">1</span>
dbPool2<span class="token punctuation">.</span>MinOpen <span class="token operator">=</span> <span class="token number">0</span>
dbPool<span class="token punctuation">.</span>TestConn <span class="token operator">=</span> <span class="token boolean">true</span>
dbPool2<span class="token punctuation">.</span>Url <span class="token operator">=</span> <span class="token string">&quot;root:123456@(127.0.0.1:3306)/test&quot;</span>

db<span class="token punctuation">.</span><span class="token function">AddDataSource</span><span class="token punctuation">(</span><span class="token string">&quot;dbPoolTest2&quot;</span><span class="token punctuation">,</span> dbPool2<span class="token punctuation">)</span>
</code></pre></div><p>这段代码只需要在项目启动时执行一次即可</p> <h3 id="字段解释"><a href="#字段解释" class="header-anchor">#</a> 字段解释</h3> <ul><li>InitialSize: 初始化连接数量</li> <li>ExpandSize: 连接用完后，每次扩展的连接数量（当连接池里的连接数已经达到最大连接数以后，这个配置将失效）</li> <li>MaxOpen: 最大连接数</li> <li>MinOpen: 最小连接数</li> <li>Url: 数据库连接字符串</li> <li>TestConn: 测试连接是否有效，一旦设置为true，如果获取到的链接已经失效，会重新获取新的连接，失败3次将会自动放弃</li></ul> <h2 id="单表操作"><a href="#单表操作" class="header-anchor">#</a> 单表操作</h2> <h3 id="根据条件查询单表数据"><a href="#根据条件查询单表数据" class="header-anchor">#</a> 根据条件查询单表数据</h3> <div class="language-go extra-class"><pre class="language-go"><code>conditions <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>entity<span class="token punctuation">.</span>Condition<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
conditions <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">GetCondition</span><span class="token punctuation">(</span><span class="token string">&quot;id &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
conditions <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">GetCondition</span><span class="token punctuation">(</span><span class="token string">&quot;and (user_name = ? or age &gt; ?)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bee&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
conditions <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">GetCondition</span><span class="token punctuation">(</span><span class="token string">&quot;order by create_time desc&quot;</span><span class="token punctuation">,</span> entity<span class="token punctuation">.</span>NotWhere<span class="token punctuation">)</span><span class="token punctuation">)</span>

resultMap<span class="token punctuation">,</span> err <span class="token operator">:=</span> operation<span class="token punctuation">.</span><span class="token function">GetDBTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;Data source name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;table name&quot;</span><span class="token punctuation">,</span> conditions<span class="token punctuation">)</span>
</code></pre></div><h3 id="根据条件修改单表数据"><a href="#根据条件修改单表数据" class="header-anchor">#</a> 根据条件修改单表数据</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 条件设定</span>
conditions <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>entity<span class="token punctuation">.</span>Condition<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
conditions <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">GetCondition</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 要修改的数据设定</span>
data <span class="token operator">:=</span> ResultStruct<span class="token punctuation">{</span>UserName<span class="token punctuation">:</span> <span class="token string">&quot;TestNoSqlUpdate&quot;</span><span class="token punctuation">}</span>

<span class="token comment">// 执行修改操作</span>
result<span class="token punctuation">,</span> err <span class="token operator">:=</span> operation<span class="token punctuation">.</span><span class="token function">GetDBTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;Data source name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;table name&quot;</span><span class="token punctuation">,</span> dbutil<span class="token punctuation">.</span><span class="token function">StructToMapIgnore</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>conditions<span class="token punctuation">)</span>
</code></pre></div><h3 id="根据条件删除单表数据"><a href="#根据条件删除单表数据" class="header-anchor">#</a> 根据条件删除单表数据</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 设定删除条件</span>
conditions <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>entity<span class="token punctuation">.</span>Condition<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
conditions <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">GetCondition</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 执行删除操作</span>
<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> operation<span class="token punctuation">.</span><span class="token function">GetDBTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;Data source name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token string">&quot;table name&quot;</span><span class="token punctuation">,</span> conditions<span class="token punctuation">)</span>
</code></pre></div><h3 id="插入一条数据"><a href="#插入一条数据" class="header-anchor">#</a> 插入一条数据</h3> <div class="language-go extra-class"><pre class="language-go"><code>data <span class="token operator">:=</span> ResultStruct<span class="token punctuation">{</span>
    UserName<span class="token punctuation">:</span> <span class="token string">&quot;TestNoSqlInsert&quot;</span><span class="token punctuation">,</span>
    UserEmail<span class="token punctuation">:</span> <span class="token string">&quot;xxxxx@163.com&quot;</span><span class="token punctuation">,</span>
    UpdateTime<span class="token punctuation">:</span> <span class="token string">&quot;2021-12-09 13:50:00&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

result<span class="token punctuation">,</span> err <span class="token operator">:=</span> operation<span class="token punctuation">.</span><span class="token function">GetDBTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;Data source name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;table name&quot;</span><span class="token punctuation">,</span> dbutil<span class="token punctuation">.</span><span class="token function">StructToMapIgnore</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="条件设定器说明"><a href="#条件设定器说明" class="header-anchor">#</a> 条件设定器说明</h3> <p>内部结构如下</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Condition <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Key <span class="token builtin">string</span>
	Val <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Key 设定条件，可以是where，order by，group by，等任意查询条件</li> <li>Val 设定值，如果Key里面是where，那么val 就是where对应的参数值</li></ul> <p>可以看如下实例</p> <div class="language-go extra-class"><pre class="language-go"><code>conditions <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>entity<span class="token punctuation">.</span>Condition<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">// 这里就是将Key设定成where条件了，所以val必须是where的值，也就是查询 id &gt; 10的数据，占位符只支持 ?</span>
conditions <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">GetCondition</span><span class="token punctuation">(</span><span class="token string">&quot;id &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 这里同上，只是前面多了一个and，因为他是第二个条件，所以需要用连接符，可以用 and，or</span>
<span class="token comment">// 像示例这样，如果and 后面 要跟一个条件组合，可以这么写，Val是一个... 类型，可以无限的往后追加参数</span>
conditions <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">GetCondition</span><span class="token punctuation">(</span><span class="token string">&quot;and (user_name = ? or age &gt; ?)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bee&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 这里就是将Key设定成 排序条件了，所以Val不需要给值，只需要设置成 entity.NotWhere 即可</span>
conditions <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> entity<span class="token punctuation">.</span><span class="token function">GetCondition</span><span class="token punctuation">(</span><span class="token string">&quot;order by create_time desc&quot;</span><span class="token punctuation">,</span> entity<span class="token punctuation">.</span>NotWhere<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="实体映射说明"><a href="#实体映射说明" class="header-anchor">#</a> 实体映射说明</h3> <p>可以用 field，ignore 两个tag，具体实例如下</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> ResultStruct <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Id         <span class="token builtin">int</span>    <span class="token string">`field:&quot;id&quot; ignore:&quot;true&quot;`</span>
	UserName   <span class="token builtin">string</span> <span class="token string">`field:&quot;user_name&quot;`</span>
	UserEmail  <span class="token builtin">string</span> <span class="token string">`field:&quot;user_email&quot;`</span>
	UpdateTime <span class="token builtin">string</span> <span class="token string">`field:&quot;update_time&quot;`</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>field 设定的值 就是数据库的字段名称，如果不设置这个 就会默认使用字段名称去跟数据库匹配</li> <li>ignore 如果设置成true 就说明这个字段会被排除在外，不参与数据库操作，如果不设置这个tag或者设置成false 则相反</li></ul> <h3 id="实体的使用"><a href="#实体的使用" class="header-anchor">#</a> 实体的使用</h3> <p>上面的几个单表操作的 实例里面 已经展示了实体的相关用法，这里再详细说明一下</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 直接使用，这种方式会让ignore 失效，无论设置成啥都不起作用</span>
<span class="token comment">// 将他的返回值 作为参数 在调用DBTemplete里面的函数时使用</span>
dbutil<span class="token punctuation">.</span><span class="token function">StructToMap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> data<span class="token punctuation">)</span>

<span class="token comment">// 让ignore 生效</span>
<span class="token comment">// 同样的，将他的返回值 作为参数，在调用DBTemplete里面的函数时使用</span>
dbutil<span class="token punctuation">.</span><span class="token function">StructToMapIgnore</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="查询结果转化成struct"><a href="#查询结果转化成struct" class="header-anchor">#</a> 查询结果转化成struct</h3> <p>查询返回的是每一行数据都是map类型的，需要使用如下函数进行转化</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 要转化成的目标struct</span>
res <span class="token operator">:=</span> ResultStruct<span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 转化函数，第一个参数是 要转化的数据，第二个参数是目标struct的指针，第三个参数是目标struct本身</span>
dbutil<span class="token punctuation">.</span><span class="token function">MapToStruct</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
</code></pre></div><p>经过了上面的转化，res里面就会有数据了</p> <h2 id="自定义sql操作"><a href="#自定义sql操作" class="header-anchor">#</a> 自定义sql操作</h2> <h3 id="根据数组参数查询"><a href="#根据数组参数查询" class="header-anchor">#</a> 根据数组参数查询</h3> <div class="language-go extra-class"><pre class="language-go"><code>param <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
param<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>

<span class="token comment">// 查多条</span>
resultMap<span class="token punctuation">,</span> err <span class="token operator">:=</span> operation<span class="token punctuation">.</span><span class="token function">GetDBTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;Data source name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SelectList</span><span class="token punctuation">(</span><span class="token string">&quot;select * from xt_message_board where id = ?&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span>

<span class="token comment">// 查一条</span>
resultMap<span class="token punctuation">,</span> err <span class="token operator">:=</span> operation<span class="token punctuation">.</span><span class="token function">GetDBTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;Data source name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SelectOne</span><span class="token punctuation">(</span><span class="token string">&quot;select * from xt_message_board where id = ?&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span>
</code></pre></div><h3 id="根据struct参数查询"><a href="#根据struct参数查询" class="header-anchor">#</a> 根据struct参数查询</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// struct参数</span>
res <span class="token operator">:=</span> ResultStruct<span class="token punctuation">{</span>Id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>

<span class="token comment">// 查多条, 注：这里需要用到占位符</span>
resultMap<span class="token punctuation">,</span> err <span class="token operator">:=</span> operation<span class="token punctuation">.</span><span class="token function">GetDBTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;Data source name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SelectListByMap</span><span class="token punctuation">(</span><span class="token string">&quot;select * from xt_message_board where id &lt; {id}&quot;</span><span class="token punctuation">,</span> dbutil<span class="token punctuation">.</span><span class="token function">StructToMap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>res<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 查一条, 注：这里需要用到占位符</span>
resultMap<span class="token punctuation">,</span> err <span class="token operator">:=</span> operation<span class="token punctuation">.</span><span class="token function">GetDBTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;Data source name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SelectOneByMap</span><span class="token punctuation">(</span><span class="token string">&quot;select * from xt_message_board where id &lt; {id}&quot;</span><span class="token punctuation">,</span> dbutil<span class="token punctuation">.</span><span class="token function">StructToMap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>res<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="根据数组参数做增删改"><a href="#根据数组参数做增删改" class="header-anchor">#</a> 根据数组参数做增删改</h3> <div class="language-go extra-class"><pre class="language-go"><code>
param <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
param<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;TestUpdate&quot;</span>
param<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>

<span class="token comment">// 无论是增删改，都是调用Exec函数，将sql和参数传入即可</span>
operation<span class="token punctuation">.</span><span class="token function">GetDBTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;Data source name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;update xt_message_board set user_name = ? where id = ?&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span>
</code></pre></div><h3 id="根据struct参数做增删改"><a href="#根据struct参数做增删改" class="header-anchor">#</a> 根据struct参数做增删改</h3> <div class="language-go extra-class"><pre class="language-go"><code>res <span class="token operator">:=</span> ResultStruct<span class="token punctuation">{</span>Id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> UserName<span class="token punctuation">:</span> <span class="token string">&quot;TestUpdateByMap&quot;</span><span class="token punctuation">}</span>

<span class="token comment">// 无论是增删改，都是调用ExecByMap函数，将sql和参数传入即可，注：这里需要用到占位符</span>
operation<span class="token punctuation">.</span><span class="token function">GetDBTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;Data source name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecByMap</span><span class="token punctuation">(</span><span class="token string">&quot;update xt_message_board set user_name = {user_name} where id = {id}&quot;</span><span class="token punctuation">,</span> dbutil<span class="token punctuation">.</span><span class="token function">StructToMap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>res<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="分页查询"><a href="#分页查询" class="header-anchor">#</a> 分页查询</h2> <h3 id="使用默认的countsql"><a href="#使用默认的countsql" class="header-anchor">#</a> 使用默认的countSql</h3> <div class="language-go extra-class"><pre class="language-go"><code>data <span class="token operator">:=</span> ResultStruct<span class="token punctuation">{</span>
    UserName<span class="token punctuation">:</span> <span class="token string">&quot;TestNoSqlInsert&quot;</span><span class="token punctuation">,</span>
    UserEmail<span class="token punctuation">:</span> <span class="token string">&quot;xxxxx@163.com&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建分页参数</span>
param <span class="token operator">:=</span> entity<span class="token punctuation">.</span>PageParam<span class="token punctuation">{</span>
    CurrentPage<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 第几页</span>
    PageSize<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>  <span class="token comment">// 每页多少条</span>
    Params<span class="token punctuation">:</span> dbutil<span class="token punctuation">.</span><span class="token function">StructToMap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> data<span class="token punctuation">)</span>， <span class="token comment">// 查询参数</span>
<span class="token punctuation">}</span>

<span class="token comment">// 执行查询操作</span>
result<span class="token punctuation">,</span> err <span class="token operator">:=</span> operation<span class="token punctuation">.</span><span class="token function">GetDBTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;Data source name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SelectPage</span><span class="token punctuation">(</span><span class="token string">&quot;select * from xt_message_board where user_name = {user_name} and user_email = {user_email}&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span>
</code></pre></div><h3 id="使用自定义的countsql"><a href="#使用自定义的countsql" class="header-anchor">#</a> 使用自定义的countSql</h3> <div class="language-go extra-class"><pre class="language-go"><code>data <span class="token operator">:=</span> ResultStruct<span class="token punctuation">{</span>
    UserName<span class="token punctuation">:</span> <span class="token string">&quot;TestNoSqlInsert&quot;</span><span class="token punctuation">,</span>
    UserEmail<span class="token punctuation">:</span> <span class="token string">&quot;xxxxx@163.com&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 你自己定义的countSql</span>
countSql <span class="token operator">:=</span> <span class="token string">&quot;Your own definition of countSql&quot;</span>

<span class="token comment">// 创建分页参数</span>
param <span class="token operator">:=</span> entity<span class="token punctuation">.</span>PageParam<span class="token punctuation">{</span>
    CurrentPage<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 第几页</span>
    PageSize<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>  <span class="token comment">// 每页多少条</span>
    Params<span class="token punctuation">:</span> dbutil<span class="token punctuation">.</span><span class="token function">StructToMap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> data<span class="token punctuation">)</span>， <span class="token comment">// 查询参数</span>
<span class="token punctuation">}</span>

<span class="token comment">// 执行查询操作</span>
result<span class="token punctuation">,</span> err <span class="token operator">:=</span> operation<span class="token punctuation">.</span><span class="token function">GetDBTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;Data source name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SelectPageCustomCount</span><span class="token punctuation">(</span><span class="token string">&quot;select * from xt_message_board where user_name = {user_name} and user_email = {user_email}&quot;</span><span class="token punctuation">,</span> countSql， param<span class="token punctuation">)</span>
</code></pre></div><h2 id="事务管理"><a href="#事务管理" class="header-anchor">#</a> 事务管理</h2> <h3 id="开启事务"><a href="#开启事务" class="header-anchor">#</a> 开启事务</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 这个id是很有用的，后面回滚和提交都会用它</span>
id<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;TestUpdateTx: &quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="提交和回滚事务"><a href="#提交和回滚事务" class="header-anchor">#</a> 提交和回滚事务</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 回滚事务</span>
db<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>

<span class="token comment">// 提交事务</span>
db<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
</code></pre></div><h3 id="连起来使用就是这样的"><a href="#连起来使用就是这样的" class="header-anchor">#</a> 连起来使用就是这样的</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 开启事务</span>
id<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;TestUpdateTx: &quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>

res <span class="token operator">:=</span> ResultStruct<span class="token punctuation">{</span>Id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> UserName<span class="token punctuation">:</span> <span class="token string">&quot;TestUpdateTx&quot;</span><span class="token punctuation">}</span>

<span class="token comment">// 注：这里使用的不是GetDBTemplate，ExecByMap，而是 GetDBTemplateTx 和 ExecByTxMap</span>
<span class="token comment">// 使用事务和不使用事务，在调用的函数上，区别就是多了个Tx</span>
ss<span class="token punctuation">,</span> err <span class="token operator">:=</span> operation<span class="token punctuation">.</span><span class="token function">GetDBTemplateTx</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">&quot;dbPoolTest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecByTxMap</span><span class="token punctuation">(</span><span class="token string">&quot;update xt_message_board set user_name = {user_name} where id = {id}&quot;</span><span class="token punctuation">,</span> dbutil<span class="token punctuation">.</span><span class="token function">StructToMap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>res<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果有问题就回滚事务</span>
    db<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    t<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;TestUpdateTx: &quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token comment">// 提交事务</span>
db<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
</code></pre></div><h2 id="web管理"><a href="#web管理" class="header-anchor">#</a> Web管理</h2> <p><a href="/cn/beerus/index.html">点击此处-&gt;跳转到Web管理</a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/cn/assets/js/app.ba28a3bd.js" defer></script><script src="/cn/assets/js/2.67bc9379.js" defer></script><script src="/cn/assets/js/10.c49379fe.js" defer></script>
  </body>
</html>
